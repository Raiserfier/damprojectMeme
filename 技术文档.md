**DAM Tech Documents - Group 2**

å»–é’° / èµµæµ©é’§ / è¯¸ç‚³å¸† / æ—é¦¨æ€¡ / å­™æ–‡æ¬£

ğŸ”— https://github.com/Raiserfier/damprojectMeme

---

# æŠ€æœ¯æ–‡æ¡£

## ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¡†æ¶ï¼šDjango+Vueå‰åç«¯åˆ†ç¦»)
  - [å‰ç«¯æ¡†æ¶](#å‰ç«¯æ¡†æ¶)
  - [åç«¯æ¡†æ¶](#åç«¯æ¡†æ¶)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
  - [ç”¨æˆ·ç®¡ç†æ¨¡å—](#ç”¨æˆ·ç®¡ç†æ¨¡å—)
  - [è¡¨æƒ…ç®¡ç†æ¨¡å—](#è¡¨æƒ…ç®¡ç†æ¨¡å—)
  - [è¡¨æƒ…æ¨èæ¨¡å—](#è¡¨æƒ…æ¨èæ¨¡å—)
  - [ç®¡ç†å‘˜æ¨¡å—](#ç®¡ç†å‘˜æ¨¡å—)
- [ç‰¹æ®Šè®¾è®¡](#ç‰¹æ®Šè®¾è®¡)
  - [å›¾ç‰‡æ¨èï¼šæ„ŸçŸ¥å“ˆå¸Œç®—æ³•](#å›¾ç‰‡æ¨èï¼šæ„ŸçŸ¥å“ˆå¸Œç®—æ³•)
  - [å›¾ç‰‡æµ](#å›¾ç‰‡æµ)

## ç³»ç»Ÿæ¡†æ¶ï¼šDjango+Vueå‰åç«¯åˆ†ç¦»

### å‰ç«¯æ¡†æ¶

#### Vue Component æ¨¡å—ç®¡ç†

ç»„ä»¶ï¼ˆComponentï¼‰æ˜¯ Vue.js æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ç»„ä»¶å¯ä»¥æ‰©å±•HTMLå…ƒç´ ï¼Œå°è£…å¯ä»¥é‡ç”¨çš„ä»£ç ã€‚åœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œç»„ä»¶æ˜¯è‡ªå®šä¹‰å…ƒç´ ï¼ŒVue.js çš„ç¼–è¯‘å™¨ä¸ºå®ƒæ·»åŠ ç‰¹æ®ŠåŠŸèƒ½ã€‚

æœ€å¸¸è§çš„å°±æ˜¯å½¢æˆçˆ¶å­ç»„ä»¶çš„å…³ç³»ï¼šç»„ä»¶ A åœ¨å®ƒçš„æ¨¡æ¿ä¸­ä½¿ç”¨äº†ç»„ä»¶ Bã€‚å®ƒä»¬ä¹‹é—´å¿…ç„¶éœ€è¦ç›¸äº’é€šä¿¡ï¼šçˆ¶ç»„ä»¶å¯èƒ½è¦ç»™å­ç»„ä»¶ä¸‹å‘æ•°æ®ï¼Œå­ç»„ä»¶åˆ™å¯èƒ½è¦å°†å®ƒå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…å‘ŠçŸ¥çˆ¶ç»„ä»¶ã€‚ç„¶è€Œï¼Œé€šè¿‡ä¸€ä¸ªè‰¯å¥½å®šä¹‰çš„æ¥å£æ¥å°½å¯èƒ½å°†çˆ¶å­ç»„ä»¶è§£è€¦ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚è¿™ä¿è¯äº†æ¯ä¸ªç»„ä»¶çš„ä»£ç å¯ä»¥åœ¨ç›¸å¯¹éš”ç¦»çš„ç¯å¢ƒä¸­ä¹¦å†™å’Œç†è§£ï¼Œä»è€Œæé«˜äº†å…¶å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚

å› æ­¤æˆ‘ä»¬çš„é¡¹ç›®åˆ©ç”¨ Vue Component çš„ç»„ä»¶åŠŸèƒ½å¯¹å‰ç«¯è¿›è¡Œäº†æ¨¡å—åŒ–æ¶æ„ï¼Œç»„ä»¶åŠç»„ä»¶é—´çš„å…³ç³»å…¥ä¸‹å›¾æ‰€ç¤ºï¼š



![](docs/%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84.png)



ç”±äºå›¾ç‰‡æµå…ƒç´ åœ¨å¤šä¸ªç½‘é¡µä¸­å¤§é‡å¤ç”¨ï¼Œå› æ­¤è¿™é‡Œå•ç‹¬ä½œä¸ºä¸€ä¸ªç»„ä»¶ï¼ˆImageStreamï¼‰è°ƒç”¨ï¼›å¹¶ä¸”æˆ‘ä»¬å¸Œæœ›å¯¼èˆªæ æ˜¯ä¸€ä¸ªå…¨å±€ç»„ä»¶ï¼Œå› æ­¤å•ç‹¬ä½œä¸ºä¸€ä¸ªç»„ä»¶ï¼Œå…¨å±€ä½¿ç”¨çš„ç”¨æ³•è®²åœ¨ Router ä¸­è®²åˆ°ï¼›å¦å¤–ï¼Œä¸€äº›ç›¸ä¼¼çš„é¡µé¢æˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†ç»„ä»¶å¤ç”¨ï¼Œä¾‹å¦‚ â€œæˆ‘çš„ä¸Šä¼ â€ å’Œ â€œæˆ‘çš„æ”¶è—â€ å› ä¸ºåŒ…å«ç›¸åŒå…ƒç´ ï¼ˆç”¨æˆ· banner å’Œé¡µå†…æœç´¢ï¼‰ï¼Œå› æ­¤å¯¹ PageWithSearch ç»„ä»¶è¿›è¡Œäº†å¤ç”¨ã€‚

#### Vue Router è·¯ç”±æ¶æ„

å‰ç«¯é¡µé¢åœ¨ Vue çš„æ¡†æ¶ä¸‹å®ç°äº†ç»„ä»¶åŒ–ï¼Œè·¯ç”±åŠŸèƒ½ç”±ä¼ ç»Ÿçš„é¡µé¢åˆ‡æ¢è½¬å˜ä¸ºç»„ä»¶çš„åˆ‡æ¢ã€‚æ•´ä¸ªåº”ç”¨å°†ä¸å­˜åœ¨é¡µé¢çš„åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å•é¡µåº”ç”¨ã€‚vue-router å°±æ˜¯ä¸€ä¸ªç®¡ç†è·¯ç”±ï¼Œå¹¶æ ¹æ®è·¯ç”±çŠ¶æ€ï¼Œåˆ‡æ¢ç»„ä»¶çš„ä¸€ä¸ªæ¡†æ¶ã€‚ 

vue-router å¯¹è·¯ç”±çš„ç®¡ç†æ˜¯ç”±ä¸€ä¸ª router å¯¹è±¡æ¥å®Œæˆï¼Œå…¶ä¸­ path å¯¹è·¯ç”±è¿›è¡Œå‘½åï¼ˆ':'åé¢ä»£è¡¨å‚æ•°ï¼‰ï¼Œcomponent æŒ‡å®šäº†<route-view> è¦åˆ‡æ¢åˆ°çš„ç»„ä»¶ï¼Œchildren æŒ‡å®šäº†è·¯ç”±çš„åµŒå¥—å…³ç³»ï¼š

```python
export default new Router({
  routes: [
    {path: '/', name: 'Home', component: Home1},
    {path: '/details/:pic/:rank', name: 'PicDetail', component: PicDetail},
    {path: '/:type/:key/:rank', name: 'PageWithTitle', component: Title},
    {path: '/:type/:id/:key/:rank', name: 'PageWithSearch', component: Channel},
    {path: '/recommend/:rank', name: 'Recommend', component: Recommend},
    {path: '/upload', name: 'Upload', component: Upload},
    {path: '/settings', name: 'Info_setting', component: Info_setting},
    {path: '/login', name: 'Login', component: User,
      children:[
        {path: '', name: 'Login', component: Login}
      ]
    },
    {path: '/register', name: 'Login', component: User,
      children:[
        {path: '', name: 'Register', component: Register}
      ]
    }
  ]
})
```

 å°†è¿™ä¸ªrouterå¯¹è±¡ç»‘å®šåˆ°æŸä¸ªç»„ä»¶ä¸Šï¼Œå®ƒå°†æ§åˆ¶è¯¥ç»„ä»¶åŠå…¶å­ç»„ä»¶çš„è·¯ç”±çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶çš„ <router-view>ï¼Œæˆä¸ºæ ¹<router-view>ã€‚ 

```html
<div id="app">
  <Nav></Nav>
  <transition name="fade" mode="out-in">
    <router-view :key="key"/>
  </transition>
</div>
```

è€Œè¿™é‡Œçš„ picã€rankã€typeã€keyã€id ç­‰æ˜¯è·¯ç”±ä¸­çš„ä¸åŒå‚æ•°ï¼Œå¯ä»¥ç”¨ this.$route.params è·å–å®ƒä»¬çš„å€¼ï¼Œå¹¶æ ¹æ®å®ƒä»¬çš„ä¸åŒå€¼å¯¹æ¸²æŸ“çš„é¡µé¢å†…å®¹è¿›è¡Œè°ƒæ•´ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½é€šè¿‡è·³è½¬è·¯ç”±æ¥åˆ·æ–°é¡µé¢ï¼Œæ›´æ–°é¡µé¢ç»„ä»¶ã€‚ä¾‹å¦‚å›¾ç‰‡æµçš„å¤šæ¬¡å¤ç”¨ï¼š

```python
created() {
    this.my_id = this.$store.state.user_id;
    this.key = this.$route.params.key;
    
    // å›¾ç‰‡è¯¦æƒ…é¡µæ¨è
    if (this.$route.params.pic !== undefined) {
        this.get_details_recommend(this.$route.params.pic, this.$store.state.user_id);
    }
    // ç”¨æˆ·é¡µ
    else if (this.$route.params.id !== undefined) {
        if (this.$route.params.type === 'channel') this.type = 2;
        else if (this.$route.params.type === 'favorite') this.type = 1;
        this.get_user(this.$route.params.id, this.type, this.key);
    }
    // æœç´¢ã€ç±»åˆ«é¡µã€ç”¨æˆ·æ¨èé¡µ
    else {
        if (this.$route.params.type === undefined) {
            this.get_recommend(this.$store.state.user_id);
        } else {
            if (this.$route.params.type === 'search') this.type = 0;
            else if (this.$route.params.type === 'category') this.type = 3;
            this.get_img(this.type, this.key);
        }
    }
}
```

#### Vue Store çŠ¶æ€ç®¡ç†

Vue ç»„ä»¶ä¸­åŒ…å«è§†å›¾ï¼ˆtemplateï¼‰ã€åŒå‘ç»‘å®šçš„æ•°æ®ï¼ˆdataï¼‰ã€ä»¥åŠä¸€äº›æ–¹æ³•ï¼ˆmethodsï¼‰ï¼Œè¿™3ä¸ªéƒ½å†™åœ¨åŒä¸€ä¸ªç»„ä»¶é‡Œé¢, ä¸€èˆ¬è§†å›¾ï¼ˆViewï¼‰è§¦å‘æ–¹æ³•åŠ¨ä½œï¼ˆActionsï¼‰ï¼ŒåŠ¨ä½œå½±å“æ•°æ®çŠ¶æ€ï¼ˆStateï¼‰, æ•°æ®çŠ¶æ€çš„æ”¹å˜åˆååº”åˆ°è§†å›¾ï¼ˆViewï¼‰ä¸Šæ¥ï¼Œè¿™æ ·åœ¨ä¸€ä¸ªç»„ä»¶å†…å°±å½¢æˆäº†ä¸€ä¸ªé—­ç¯ã€‚å³å½“å‰ç»„ä»¶çš„è§†å›¾ä½¿ç”¨å½“å‰ç»„ä»¶çš„æ•°æ®ï¼Œå½“å‰ç»„ä»¶çš„åŠ¨ä½œï¼ˆæ–¹æ³•ï¼‰åªä¿®æ”¹å½“å‰ç»„ä»¶çš„æ•°æ®ï¼Œæ€»ä½“æ¥è¯´åªèƒ½è‡ªå·±è·Ÿè‡ªå·±ç©ï¼Œä¸èƒ½å¤šä¸ªç»„ä»¶äº’é€šã€‚

ä½†åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦ç”¨åˆ°ä¸€äº›å…¨å±€å˜é‡ï¼Œå¦‚ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€ç”¨æˆ·idç­‰ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ Vuex è¿›è¡Œå…¨å±€å•ä¾‹æ¨¡å¼ç®¡ç†ï¼Œè¿™æ ·æ‰€æœ‰ç»„ä»¶åœ¨ä»»æ„æ—¶å€™éƒ½å¯ä»¥è®¿é—®å…¨å±€çŠ¶æ€ã€‚å½“åœ¨ä»»æ„ç»„ä»¶ä¸­ä¿®æ”¹å…¨å±€çŠ¶æ€ï¼Œæ‰€æœ‰å¼•ç”¨å…¨å±€çŠ¶æ€çš„è§†å›¾ä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼ˆå“åº”å¼ï¼‰ã€‚

ç®€å•æ¥è¯´Vuexåœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªå…¨å±€å®ä¾‹å¯¹è±¡ï¼ˆStoreï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯¥å®ä¾‹å¯¹è±¡æ˜¯æ•´ä¸ªåº”ç”¨çº§åˆ«çš„ï¼Œ ä¸€ä¸ªå¯¹è±¡å°±åŒ…å«äº†å…¨éƒ¨çš„åº”ç”¨å±‚çº§çŠ¶æ€ã€‚ store è¢«ç§°ä¸ºä»“åº“ï¼Œç”¨äºç››æ”¾å…¨å±€çŠ¶æ€çš„å®¹å™¨ã€‚ä»»ä½•ç»„ä»¶éƒ½èƒ½è®¿é—®å…¨å±€å¯¹è±¡çš„æ•°æ®ï¼ˆStateï¼‰ï¼Œä»»ä½•ç»„ä»¶éƒ½å¯ä»¥ä¿®æ”¹å…¨å±€å¯¹è±¡çš„æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„è®¾è®¡æ¨¡å¼ä¸­çš„â€œå•ä¾‹æ¨¡å¼â€ã€‚

```python
    state:{
        //ç™»å½•çŠ¶æ€
        login: false,
        user_id: "99",
        user_name: "Tester",
        manager: false
    },
   	mutations:{
        //ç™»å½•çŠ¶æ€æ›´æ–°
        login(state,userid,username,isManager){
            state.login = true;
            state.user_id = userid;
            state.user_name = username;
            state.manager = isManager;
        },
        logout(state){
            state.login = false;
            state.user_id = "99";
            state.user_name = "Tester";
            state.manager = false;
        }
    }
```

### åç«¯æ¡†æ¶

ä¹‹æ‰€ä»¥é€‰ç”¨Djangoä½œä¸ºåç«¯æ¡†æ¶ï¼Œæ˜¯å› ä¸ºåœ¨åç«¯å¼€å‘æ—¶Djangoæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š

#### å¼ºå¤§çš„æ•°æ®åº“åŠŸèƒ½

Djangoç”¨pythonçš„ç±»ç»§æ‰¿ï¼Œå‡ è¡Œä»£ç å°±å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªä¸°å¯Œã€åŠ¨æ€çš„æ•°æ®åº“æ“ä½œæ¥å£ï¼ˆAPIï¼‰ï¼Œå¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œ SQL è¯­å¥**ORM**ï¼ˆObject-Relational Mappingâ€œå¯¹è±¡-å…³ç³»-æ˜ å°„â€ï¼‰ï¼Œå®ƒå®ç°äº†æ•°æ®æ¨¡å‹ä¸æ•°æ®åº“çš„**è§£è€¦**ï¼Œå³æ•°æ®æ¨¡å‹çš„è®¾è®¡ä¸éœ€è¦ä¾èµ–äºç‰¹å®šçš„æ•°æ®åº“ï¼Œé€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥è½»æ¾æ›´æ¢æ•°æ®åº“ã€‚

#### è‡ªä¸»ç®¡ç†åå°

admin interfaceæ˜¯Django é‡Œæ¯”è¾ƒå¸å¼•çœ¼çƒçš„ä¸€é¡¹contribï¼Œè®©ä½ å‡ ä¹ä¸ç”¨å†™ä¸€è¡Œä»£ç å°±æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„åå°ç®¡ç†ç•Œé¢ã€‚åªè¦æ³¨å†Œæ¨¡å‹ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨admin interfaceä¸­å¯¹è¯¥æ¨¡å‹çš„å¯¹è±¡è¿›è¡Œå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œï¼Œå¯ä»¥å½“ä½œä¸€ä¸ªç¾åŒ–UIåçš„æ•°æ®åº“æ¥ä½¿ç”¨ã€‚

![1574830702256](docs\1574830702256.png)

![1574830847634](docs\1574830847634.png)

![1574830876365](docs\1574830876365.png)

#### URL design

Djangoçš„urlæ¨¡å—è®¾è®¡å¾—çœ‹ä¼¼å¾ˆå¤æ‚ï¼Œéƒ½æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†çœŸæ­£ç”¨åˆ°çš„éƒ½æ˜¯å¾ˆç®€å•çš„æ­£åˆ™ï¼Œåœ°å€çš„è¡¨è¾¾å¯ä»¥éšå¿ƒæ‰€æ¬²ï¼Œé‚£äº›ä¼˜ç¾çš„ï¼Œç®€æ´çš„ï¼Œä¸“ä¸šçš„åœ°å€ï¼Œä¸ç®¡å“ªç§ï¼Œéƒ½èƒ½è¡¨ç°å‡ºæ¥ã€‚

#### Appç†å¿µ

Djangoçš„Appå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¢å‡ï¼Œä¸éœ€è¦äº†ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ï¼Œå¯¹ç³»ç»Ÿå½±å“ä¸å¤§ã€‚

#### é”™è¯¯æç¤º

Djangoçš„é”™è¯¯æç¤ºåšå¾—å¾ˆè¯¦ç»†ï¼Œå…·ä½“åˆ°è¡Œï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ ¹æ®é”™è¯¯æç¤ºçŸ¥é“å‡ºé”™çš„åœ°æ–¹ã€‚

Djangoä½¿ç”¨çš„æ˜¯MVCæ¨¡å¼ã€MVTæ¡†æ¶ã€‚MVC æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯è§£è€¦ï¼Œå³æ•°æ®æ¨¡å‹çš„è®¾è®¡ä¸éœ€è¦ä¾èµ–äºç‰¹å®šçš„æ•°æ®åº“ï¼Œé€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥è½»æ¾æ›´æ¢æ•°æ®åº“ï¼Œå…¶ä¸­Mè¡¨ç¤º modelï¼Œä¸»è¦ç”¨äºå¯¹æ•°æ®åº“å±‚çš„å°è£…ï¼ŒVè¡¨ç¤º viewï¼Œç”¨äºå‘ç”¨æˆ·å±•ç¤ºç»“æœï¼ŒCè¡¨ç¤º controllerï¼Œæ˜¯æ ¸å¿ƒï¼Œç”¨äºå¤„ç†è¯·æ±‚ã€è·å–æ•°æ®ã€è¿”å›ç»“æœã€‚è€Œåœ¨MVTä¸­ï¼ŒMè¡¨ç¤º modelï¼Œè´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼ŒVè¡¨ç¤ºviewï¼Œæ˜¯æ ¸å¿ƒï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€è·å–æ•°æ®ã€è¿”å›ç»“æœï¼ŒTè¡¨ç¤ºtemplateï¼Œè´Ÿè´£å‘ˆç°å†…å®¹åˆ°æµè§ˆå™¨ã€‚

![1574831861060](docs\1574831861060.png)

Djangoçš„æ ¸å¿ƒæ¨¡å—åŒ…æ‹¬**urls.py**ã€**views.py**ã€**models.py**ã€**forms.py**ã€**templates æ–‡ä»¶å¤¹**ã€**admin.py**ã€‚ä¸‹é¢æˆ‘å°†ç€é‡ä»‹ç»ä»¥ä¸‹**urls.py**ã€**view.py**å’Œ**models.py**ã€‚å…¶ä¸­ï¼Œ**urls.py**é‡Œæ˜¯å‰ç«¯è®¿é—®åç«¯çš„è·¯ç”±ï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„è·¯ç”±å†™æ˜äº†adminåå°ç®¡ç†åœ°å€ï¼Œä»¥åŠå‰ç«¯æ¸²æŸ“å¥½çš„æ•´ä½“HTMLåœ°å€ï¼›è€Œåœ¨Appä¸­çš„è·¯ç”±å†™æ˜äº†å‰ç«¯è®¿é—®åç«¯å‡½æ•°çš„åœ°å€å’Œæ¥å£ã€‚

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('emoji.urls')),
    path('', TemplateView.as_view(template_name="index.html")),
]
```

```python
urlpatterns = [
    path('create_user', views.create_user),
    path('login', views.login),
    path('get_by_classification', views.get_by_classification),
    path('get_images', views.get_images),
]
```

åœ¨ä¸Šè¿°ä»£ç è·¯å¾„ä¸­çš„view.xxxæ˜¯å¼•ç”¨äº†**view.py**ä¸­çš„å‡½æ•°ï¼Œå…¶ä¸­xxxæ˜¯å‡½æ•°åã€‚**views.py**ä¸­æ˜¯åç«¯å‡½æ•°çš„é›†åˆï¼Œ**åœ¨urls.py**ä¸­æ·»åŠ è¿‡pathçš„å‡½æ•°å¯ä»¥è¢«å‰ç«¯è®¿é—®åˆ°ï¼Œå…¶ä½™å‡½æ•°ä¸èƒ½è¢«å‰ç«¯è®¿é—®åˆ°ã€‚

**models.py**é‡Œæ˜¯æˆ‘ä»¬å®šä¹‰çš„æ•°æ®åº“æ¨¡å‹ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æ˜¯ä¸€ä¸ªclassç±»ï¼Œæ¯ä¸ªç±»ä¸­å®šä¹‰äº†å„è‡ªä¸åŒç±»å‹çš„å˜é‡ã€‚

```python
class User(models.Model):
    username = models.CharField(max_length=20)
    portrait = models.CharField(default='', max_length=10000)
    email = models.EmailField(max_length=40, default='')
    password = models.CharField(max_length=20)
    like_images = models.TextField(default='')
    profile = models.CharField(default='', max_length=100)
    private = models.IntegerField(default=0)
```

è€Œ**admin.py**åˆ™ç”¨äºæ¨¡å‹çš„æ³¨å†Œï¼Œæ³¨å†Œè¿‡çš„æ¨¡å‹å¯ä»¥ç›´æ¥åœ¨Djangoçš„admin interfaceä¸Šä½¿ç”¨ã€‚

#### æ•°æ®æ¨¡å‹

[ERå›¾]



## ä¸»è¦åŠŸèƒ½

### ç”¨æˆ·ç®¡ç†æ¨¡å—

#### æ¨¡å‹

ç”¨æˆ·æ¨¡å‹UseråŒ…æ‹¬ç”¨æˆ·åusernameã€ç”¨æˆ·ç®€ä»‹profileã€å¤´åƒportraitã€é‚®ç®±emailã€å¯†ç passwordã€å–œæ¬¢çš„å›¾ç‰‡like_imageså’Œéšç§å›¾ç‰‡privateã€‚è€ƒè™‘åˆ°åœ¨ç°å®æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·çš„é‚®ç®±è´¦å·éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠé‚®ç®±ä½œä¸ºéšå½¢æ ‡å¿—æ¯ä¸ªç”¨æˆ·å”¯ä¸€æ€§çš„å±æ€§ã€‚

#### æ³¨å†Œ

åœ¨æ³¨å†Œç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç è¿›è¡Œè´¦æˆ·çš„åˆ›å»ºã€‚è‹¥è´¦æˆ·é‚®ç®±åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œåˆ™æç¤ºç”¨æˆ·è´¦æˆ·å·²å­˜åœ¨ï¼Œé˜²æ­¢åˆ›å»ºé‡å¤è´¦æˆ·ã€‚åˆ›å»ºè´¦æˆ·æˆåŠŸåï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œç™»å½•ã€‚ç”¨æˆ·çš„ä¿¡æ¯å¦‚å¤´åƒã€ç”¨æˆ·ç®€ä»‹éƒ½è®¾ç½®ä¸ºäº†é»˜è®¤å€¼ï¼Œå…¶ä»–ä¿¡æ¯å¦‚å–œæ¬¢çš„å›¾ç‰‡å’Œéšç§å›¾ç‰‡éƒ½è®¾ç½®ä¸º0ã€‚

```python
User.objects.create(username=username, email=email, password=password)
```

#### ç™»å½•

åœ¨åˆ›å»ºè´¦æˆ·åï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œç™»å½•ã€‚æˆ‘ä»¬è®¾ç½®äº†ç™»å½•æ£€æŸ¥æ¥è§„èŒƒåŒ–ç”¨æˆ·çš„ç™»å½•ã€‚ç”¨æˆ·åœ¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡åœ¨æ•°æ®åº“æŸ¥æ‰¾ç”¨æˆ·åæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™æç¤ºç”¨æˆ·åé”™è¯¯ï¼›å¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œä½†æ˜¯å¯†ç ä¸æ•°æ®åº“ä¸­çš„å¯†ç ä¸åŒ¹é…ï¼Œåˆ™æç¤ºå¯†ç é”™è¯¯ï¼›å½“ç”¨æˆ·å­˜åœ¨ä¸”è¾“å…¥çš„å¯†ç ä¸æ•°æ®åº“ä¸­å¯†ç åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºç”¨æˆ·ç™»å½•æˆåŠŸã€‚åç«¯è¿”å›SUCCESSå’Œç”¨æˆ·åï¼Œå‰ç«¯ç•Œé¢è·³è½¬è‡³ç”¨æˆ·ä¸»é¡µï¼Œå¹¶åœ¨å³ä¸Šè§’æ˜¾ç¤ºç›®å‰ç™»å½•çš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚

```python
try:
    user = User.objects.get(email=email)

    if user.password == password:
        response = {}
        response['msg'] = 'SUCCESS'
        response['username'] = user.username
        response['manager'] = user.manager
        return JsonResponse(response)
    else:
        return HttpResponse("å¯†ç é”™è¯¯")
except:
    return HttpResponse("ç”¨æˆ·åé”™è¯¯")
```

#### æ³¨é”€

ç”±äºæˆ‘ä»¬åœ¨ç™»å½•çŠ¶æ€è·¯ç”±ä¼šæœ‰ç”¨æˆ·åï¼Œè€Œå‰ç«¯é€šè¿‡è·¯ç”±æ¥è·å–ç”¨æˆ·åï¼Œæ³¨é”€é€šè¿‡æ”¹å˜è·¯ç”±æ¥å®ç°ã€‚

#### è®¾ç½®

è®¾ç½®ç”¨æˆ·ä¿¡æ¯åˆ†ä¸ºä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ˜¯æ™®é€šä¿¡æ¯çš„è®¾ç½®ï¼Œå¦ä¸€ä¸ªæ˜¯å¯†ç çš„è®¾ç½®ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é‚®ç®±ä½œä¸ºå”¯ä¸€æ ‡è¯†æ¥è®¾ç½®å…¶ä»–ä¿¡æ¯ã€‚

è®¾ç½®æ™®é€šä¿¡æ¯æ—¶ï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹ç”¨æˆ·åã€ç”¨æˆ·ç®€ä»‹ã€å¤´åƒä»¥åŠä¸ªäººä¸»é¡µéšç§çŠ¶æ€ç­‰ä¿¡æ¯ã€‚åœ¨æ•°æ®åº“é€šè¿‡é‚®ç®±æ‰¾åˆ°è¯¥ç”¨æˆ·å¯¹è±¡ï¼Œç›´æ¥ä¿®æ”¹ç›¸åº”ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·å¯¹ä¸ªäººä¸»é¡µè®¾ç½®äº†éšç§çŠ¶æ€ï¼Œåˆ™å…¶ä»–ç”¨æˆ·æ— æ³•é€šè¿‡ç‚¹å‡»ä¸ªäººå¤´åƒè¿›å…¥ä»–çš„ä¸ªäººä¸»é¡µã€‚

è®¾ç½®å¯†ç æ—¶ï¼Œç”¨æˆ·åœ¨è¾“å…¥æ—§å¯†ç ï¼Œåœ¨æ•°æ®åº“é€šè¿‡é‚®ç®±æ‰¾åˆ°è¯¥ç”¨æˆ·å¯¹è±¡ï¼Œæ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„æ—§å¯†ç æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„å¯†ç ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œæ‰å…è®¸ç”¨æˆ·ä¿®æ”¹å¯†ç ã€‚

### è¡¨æƒ…ç®¡ç†æ¨¡å—

#### æ¨¡å‹

å›¾ç‰‡æ¨¡å‹ImageåŒ…æ‹¬å›¾ç‰‡ç±»åˆ«classificationã€æ”¶è—æ€»æ•°total_likesã€ç‚¹èµæ€»æ•°total_thumbsã€ä¸Šä¼ æ—¶é—´upload_timeã€å›¾ç‰‡imgã€ä¸Šä¼ è€…ownerã€æ˜¯å¦éšç§privateã€‚æ¯å¼ å›¾ç‰‡éƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ ä¸Šæ¥çš„ï¼Œæ‰€ä»¥éƒ½ä¼šæœ‰ä¸€ä¸ªä¸Šä¼ è€…ownerå±æ€§ï¼Œè¯¥å±æ€§æ˜¯Userçš„å¤–é”®ã€‚

æ ‡ç­¾æ¨¡å‹Tagæ˜¯ä¸ºäº†æ–¹ä¾¿åˆ†å‡ºæ¥çš„ä¸€ä¸ªæ¨¡å‹ï¼ŒåŒ…æ‹¬å†…å®¹contentå’Œé¢‘ç‡frequencyã€‚

è½¬åŒ–æ¨¡å‹Image2tagå°†å›¾ç‰‡å’Œæ ‡ç­¾æ¨¡å‹åšå¯¹åº”ï¼Œè¯¥æ¨¡å‹åŒ…æ‹¬å›¾ç‰‡imageã€æ ‡ç­¾tagï¼Œè¿™ä¸¤ä¸ªå±æ€§åˆ†åˆ«å¤–é”®æ¨¡å‹Imageå’ŒTagã€‚

#### ä¸Šä¼ 

ç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½çœ‹åˆ°ä¸Šä¼ æŒ‰é’®å¹¶ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è¿›è¡Œå›¾ç‰‡çš„ä¸Šä¼ ã€‚ç”¨æˆ·é€‰æ‹©ä¸Šä¼ çš„å›¾ç‰‡åï¼Œå¯ä»¥å†³å®šæ˜¯å¦è¦ç»™å›¾ç‰‡æ·»åŠ æ°´å°ã€‚ä¸Šä¼ å®Œæˆåï¼Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡æŒ‰é’®ï¼Œå³å¯è®¿é—®åç«¯çš„ä¸Šä¼ å‡½æ•°å°†å›¾ç‰‡æ·»åŠ è¿›æ•°æ®åº“ã€‚åç«¯è·å–ç”¨æˆ·çš„ç”¨æˆ·åï¼Œä»æ•°æ®åº“ä¸­å°†è¯¥ç”¨æˆ·å¯¹è±¡å–å‡ºï¼Œè¿›è¡Œåç»­æ“ä½œã€‚

```python
email = request.POST.get("email")
classification = request.POST.get("classification")
tagstr = request.POST.get("tags")
tags = json.loads(tagstr)
img = request.POST.get("img")
state = request.POST.get("state")
private = request.POST.get("private")
```

åç«¯è·å–å›¾ç‰‡ç›¸å…³æ‰€æœ‰ä¿¡æ¯åï¼Œè¿›è¡Œå›¾ç‰‡å¯¹è±¡çš„åˆ›å»ºã€‚

```python
user = User.objects.get(email=email)
img = Image.objects.create(classification=classification, img=img, private=pri, owner=user)
```

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜è¦å¯¹ç”¨æˆ·è¾“å…¥çš„æ ‡ç­¾è¿›è¡Œæ“ä½œã€‚é¦–å…ˆåœ¨Tagæ¨¡å‹çš„å¯¹è±¡ä¸­å¯»æ‰¾è¾“å…¥çš„æ ‡ç­¾æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±å°†åŸæœ‰çš„æ ‡ç­¾frequencyå±æ€§åŠ ä¸€ï¼Œå¦åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾å¯¹è±¡ã€‚åŒæ—¶ï¼Œå°†å›¾ç‰‡å¯¹è±¡å’Œæ ‡ç­¾å¯¹è±¡é€šè¿‡Image2tagæ¨¡å‹è¿›è¡Œä¸€ä¸€å¯¹åº”ã€‚

```python
taginfo = Tag.objects.filter(content=tag)
if taginfo.exists():
    tagobj = taginfo.first()
    tagobj.frequency += 1
    tagobj.save()
else:
    Tag.objects.create(content=tag)
```

æ¥ä¸‹æ¥ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦éœ€è¦æ·»åŠ æ°´å°ï¼Œå¦‚æœç”¨æˆ·ä¸éœ€è¦æ·»åŠ æ°´å°ï¼Œå°±ä¸åšä»»ä½•æ“ä½œï¼Œå¦åˆ™ï¼Œè°ƒç”¨æ·»åŠ æ°´å°å‡½æ•°add_watermarkè¿›è¡Œæ°´å°çš„æ·»åŠ ï¼Œæ·»åŠ æ°´å°åçš„å›¾ç‰‡å°†è¦†ç›–åŸå›¾å­˜å…¥æ•°æ®åº“ã€‚

#### ä¸‹è½½

æ— è®ºæ˜¯ç”¨æˆ·è¿˜æ˜¯æ¸¸å®¢ï¼Œéƒ½å¯ä»¥ä¸‹è½½ç½‘ç«™ä¸Šçš„å›¾ç‰‡åˆ°æœ¬åœ°ã€‚ç”±äºæµè§ˆå™¨çš„å®‰å…¨æ€§é™åˆ¶ï¼Œæˆ‘ä»¬çš„å›¾ç‰‡å°†ç»Ÿä¸€ä¸‹è½½æµè§ˆå™¨æŒ‡å®šçš„ä¸‹è½½æ–‡ä»¶å¤¹å†…ã€‚æˆ‘ä»¬å¯¹ç”¨æˆ·ä¸‹è½½çš„å›¾ç‰‡ä»¥ä¸‹è½½æ—¶é—´å‘½åï¼Œæ¥å®ç°åŒä¸€å¼ å›¾ç‰‡çš„å¤šæ¬¡ä¸‹è½½ã€‚

ä¸‹è½½ä¸»è¦ç”±jså®ç°ï¼Œä½¿ç”¨äº†file-saveræ’ä»¶å®ç°ä¸‹è½½ã€‚å› ä¸ºæˆ‘ä»¬çš„å›¾ç‰‡éƒ½å·²base64ä½urlå½¢å¼å­˜å‚¨äºæ•°æ®åº“å†…ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œäº†ä¸€äº›å¤„ç†ï¼Œè·å¾—å›¾åƒæºæ•°æ®å’Œå›¾åƒå­˜å‚¨ç±»å‹ï¼Œæœ€åæ ¹æ®åç«¯æä¾›çš„æ–‡ä»¶åè¿›è¡Œä¸‹è½½ã€‚

```javascript
download() {
    let FileSaver = require('file-saver');
    this.$api.post('/download', {
    	id: this.$route.params.pic,
    }).then(response => {
    	this.filename = response.data.filename;
        const regex = new RegExp('^data:([^/]+/([^;]+));base64');
        const b64Data = this.img.replace(regex, '$1,$2').split(',');
        const contentType = b64Data[0];
        const raw = window.atob(b64Data[2]);
        const rawLength = raw.length;
        let uInt8Array = new Uint8Array(rawLength);
        for (let i = 0; i < rawLength; ++i)
        	uInt8Array[i] = raw.charCodeAt(i);
        const blob = new Blob([uInt8Array], {type: contentType});
        console.log(this.filename, contentType)
        FileSaver.saveAs(blob, this.filename);
        this.$message.success('ä¸‹è½½æˆåŠŸï¼');
    }), (response) => {
    	this.$message.error('ä¸‹è½½å¤±è´¥ï¼');}
```

#### åˆ é™¤

ç”¨æˆ·å¯ä»¥åˆ é™¤è‡ªå·±ä¸Šä¼ çš„å›¾ç‰‡ã€‚é€šè¿‡è·å–å›¾ç‰‡ç‹¬ç‰¹çš„idï¼Œè°ƒç”¨åç«¯æ•°æ®åº“åˆ é™¤å›¾ç‰‡æ–‡ä»¶ï¼ŒåŒæ—¶åˆ é™¤å­˜åœ¨äºæ‰€æœ‰ç”¨æˆ·ä¸­çš„å…³äºè¿™å¼ å›¾ç‰‡çš„æ”¶è—ä¿¡æ¯ã€‚

è¿™é‡Œçš„åˆ é™¤éœ€è¦è°ƒç”¨ä¸€éæ‰€æœ‰çš„ç”¨æˆ·ï¼Œå¯¹äºä¸­å°å‹çš„æ•°æ®åº“æ˜¯é€‚ç”¨çš„ï¼Œä½†æ˜¯å¯¹äºå¤§å‹æ•°æ®åº“å¼€é”€è¿‡å¤§ã€‚ä¼˜åŒ–æ–¹å‘å¯ä»¥å°†ç”¨æˆ·ä¸æ”¶è—å›¾ç‰‡çš„å…³ç³»å•ç‹¬å»ºç«‹ä¸€ä¸ªå…³ç³»æ¨¡å‹ï¼Œå¤–é”®å®ä½“ç”¨æˆ·å’Œå®ä½“å›¾ç‰‡ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç”±äºå›¾ç‰‡é‡å’Œç”¨æˆ·é‡æš‚æ—¶ä¸ä¼šè¾¾åˆ°å¤§å‹çš„ç¨‹åº¦ï¼Œæ‰€ä»¥ä¸é‡‡ç”¨æ›´å¤æ‚çš„æ¨¡å‹å…³ç³»ã€‚

```python
Image.objects.get(id=int(image_id)).delete()
users = User.objects.all()
deletech = '#' + image_id + '#'
for user in users:
    if deletech in user.like_images:
        user.like_images = user.like_images.replace('#' + image_id + '#', '')
        user.save()
```

#### æœç´¢

ç”¨æˆ·å¯ä»¥é€šè¿‡æ ‡ç­¾ã€ç±»åˆ«ç­‰å¯¹å›¾ç‰‡è¿›è¡Œæœç´¢ã€‚å¦‚æœä»€ä¹ˆéƒ½ä¸è¾“å…¥ï¼Œæ­¤æ—¶type=0ï¼Œé»˜è®¤æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡ï¼Œè¿”å›å­—å…¸ç±»å‹çš„æ•°æ®ï¼Œé‡Œé¢å­˜å‚¨å›¾ç‰‡çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¢«è¯¥ç”¨æˆ·ç‚¹èµå’Œæ”¶è—çš„çŠ¶æ€ã€‚

```python
return {
    'id': image.id,
    'img': image.img,
    'upload_time': str(image.upload_time),
    'classification': image.classification,
    'tags': json.dumps(tags),
    'likes': str(image.total_likes),
    'thumbs': str(image.total_thumbs),
    'name': image.owner.username,
    'portrait': image.owner.portrait,
    'profile': image.owner.profile,
    'state': state
}
```

å½“ç”¨æˆ·ç‚¹å‡»ç”¨æˆ·æ”¶è—çš„å›¾ç‰‡æ—¶ï¼Œtype=1ï¼Œæ ¹æ®ç”¨æˆ·é‚®ç®±æ‰¾åˆ°ç”¨æˆ·å¯¹è±¡ï¼Œè¿›è€Œæ‰¾åˆ°è¯¥ç”¨æˆ·å¯¹è±¡çš„like_imageså±æ€§ï¼Œä»ä¸­æå–æ‰€æœ‰çš„å›¾ç‰‡idï¼Œå†å°†å¾—åˆ°çš„å›¾ç‰‡idä¸å›¾ç‰‡åº“ä¸­æ‰€æœ‰çš„å›¾ç‰‡è¿›è¡Œæ¯”è¾ƒã€‚å› ä¸ºæ¯å¼ å›¾ç‰‡çš„idæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥å¯ä»¥æ‰¾åˆ°æ¯å¼ ç”¨æˆ·æ”¶è—çš„å›¾ç‰‡ã€‚å½“ç”¨æˆ·ç‚¹å‡»ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æ—¶ï¼Œtype=2ï¼Œç”±äºæ¯å¼ å›¾ç‰‡éƒ½æœ‰Userçš„å¤–é”®ï¼Œéå†å›¾ç‰‡åº“ï¼Œå°†æ¯å¼ å›¾ç‰‡çš„å±æ€§ownerä¸è¯¥ç”¨æˆ·å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œå°±å¯ä»¥æ‰¾åˆ°è¯¥ç”¨æˆ·ä¸Šä¼ çš„æ‰€æœ‰å›¾ç‰‡ã€‚å½“ç”¨æˆ·æœç´¢æ¯ä¸€ç±»åˆ«çš„å›¾ç‰‡æ—¶ï¼Œtype=3ï¼Œéå†å›¾ç‰‡åº“ï¼Œæ‰¾å‡ºclassificationå±æ€§ä¸å¯¹åº”ç±»åˆ«ç›¸åŒçš„å›¾ç‰‡ï¼Œå³å®Œæˆæœç´¢ã€‚

#### ç‚¹èµå’Œæ”¶è—

æˆ‘ä»¬å°†ç‚¹èµå’Œæ”¶è—åˆ†æˆäº†ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªåŠŸèƒ½åœ¨å®ç°ä¸Šå¾ˆç±»ä¼¼ã€‚

ç”¨æˆ·åªæœ‰ç™»å½•åæ‰èƒ½å¯¹å›¾ç‰‡è¿›è¡Œç‚¹èµå’Œæ”¶è—æ“ä½œã€‚æ¯å¼ å›¾ç‰‡éƒ½æœ‰ä¸€ä¸ªç‚¹èµå›¾æ ‡å’Œæ”¶è—å›¾æ ‡ï¼Œç”¨äºæ ‡è¯†å½“å‰ç™»å½•çš„ç”¨æˆ·æ˜¯å¦å·²å¯¹å›¾ç‰‡è¿›è¡Œè¿‡ç‚¹èµå’Œæ”¶è—æ“ä½œã€‚å½“ç”¨æˆ·å¯¹å›¾ç‰‡ç‚¹èµæˆ–æ”¶è—åï¼Œå¯¹åº”çš„å›¾æ ‡ä¼šæ”¹å˜é¢œè‰²ï¼ŒåŒæ—¶å‰ç«¯ä¼šè®°å½•ä¸‹å½“å‰ç”¨æˆ·çš„é‚®ç®±ã€å›¾ç‰‡idå’ŒçŠ¶æ€å¹¶è¿”å›ç»™åç«¯ã€‚

åç«¯é€šè¿‡æŸ¥è¯¢é‚®ç®±å’Œå›¾ç‰‡idåˆ†åˆ«è·å–å¯¹åº”ç”¨æˆ·å¯¹è±¡å’Œå›¾ç‰‡å¯¹è±¡ã€‚å¦‚æœçŠ¶æ€æ˜¯trueï¼Œå°±å°†è¯¥å›¾ç‰‡çš„idæ·»åŠ åˆ°è¯¥ç”¨æˆ·çš„like_imagesä¸­ï¼ŒåŒæ—¶å°†å›¾ç‰‡å¯¹è±¡çš„total_likesæˆ–total_thumbsåŠ ä¸€ï¼›å¦‚æœçŠ¶æ€æ˜¯falseï¼Œå°±åœ¨è¯¥ç”¨æˆ·çš„like_imagesä¸­æŸ¥æ‰¾å›¾ç‰‡çš„idå¹¶åˆ é™¤ï¼ŒåŒæ—¶å°†å›¾ç‰‡å¯¹è±¡çš„total_likeså‡ä¸€ã€‚

ç”±äºå‰ç«¯çŠ¶æ€é»˜è®¤falseï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»ä¸€å¼ å›¾ç‰‡åï¼ŒçŠ¶æ€åªä¼šå˜æˆtrueï¼Œtotal_likesæˆ–total_thumbsæ‰§è¡Œçš„æ°¸è¿œæ˜¯åŠ ä¸€çš„æ“ä½œï¼Œä¸ä¼šå‡ºç°æ˜¯è´Ÿæ•°çš„æƒ…å†µã€‚

```python
if state == "true":
    image.total_likes += 1
    user.like_images += '#' + image_id + '#'
    image.save()
    user.save()
    return HttpResponse("SUCCESS")
else:
    image.total_likes -= 1
    user.like_images = user.like_images.replace('#' + image_id + '#', '')
    image.save()
    user.save()
    return HttpResponse("SUCCESS")
```

#### ä¸¾æŠ¥

å¦‚æœé‡åˆ°äº†è¿åäº†ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚çš„å›¾ç‰‡ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œä¸¾æŠ¥æ“ä½œã€‚ä¸¾æŠ¥åçš„å›¾ç‰‡ä¼šè¿›å…¥ä¸¾æŠ¥æ•°æ®åº“ï¼Œç”±ç®¡ç†å‘˜ç”¨æˆ·ç»Ÿä¸€è¿›è¡Œå®¡æ ¸åˆ é™¤ã€‚

```python
def report_image(request):
    """ä¸¾æŠ¥å›¾ç‰‡
    :param request:
    :return: å¤„ç†çŠ¶æ€
    """
    try:
        img_id = request.POST.get("id")
        reason = request.POST.get("reason")
        image = Image.objects.get(id=int(img_id))
        img = Report.objects.create(image=image, reason=reason)
        return HttpResponse("SUCCESS")
    except:
        return HttpResponse("æ²¡æœ‰æ­¤å›¾ç‰‡")
```

#### éšç§ç®¡ç†

å›¾ç‰‡åœ¨ä¸Šä¼ çš„æ—¶å€™å¯ä»¥å¯¹å›¾ç‰‡è®¾ç½®éšç§çŠ¶æ€ã€‚ä¸€æ—¦éšç§çŠ¶æ€ä¸ºçœŸï¼Œé‚£ä¹ˆå›¾ç‰‡å°†æ— æ³•è¢«é™¤äº†ç”¨æˆ·æœ¬äººçš„å…¶ä»–æ‰€æœ‰äººçœ‹è§ã€‚åœ¨è¿”å›å›¾ç‰‡ç»™å‰ç«¯å±•ç¤ºå›¾ç‰‡æ—¶ï¼Œåç«¯é€šè¿‡éšç§çŠ¶æ€å†³å®šæ˜¯å¦å°†å›¾ç‰‡æ”¾å…¥è¿”å›æ•°æ®ä¸­ï¼Œå¦‚æœè®¾ç½®äº†éšç§åˆ™å¿½ç•¥ã€‚

```python
            if image.private:
                continue
```

#### ç‰ˆæƒç®¡ç†

æˆ‘ä»¬æä¾›äº†ç»™å›¾ç‰‡åŠ æ°´å°çš„åŠŸèƒ½ï¼Œå½“æ¯å¼ å›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å‹¾é€‰â€æ·»åŠ æ°´å°â€œæŒ‰é’®æ¥é€‰æ‹©æ˜¯å¦æ·»åŠ æ°´å°ã€‚

å¯¹äºè¦æ·»åŠ æ°´å°çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å‚è€ƒæ–°æµªå¾®åšçš„æ·»åŠ æ°´å°æ–¹å¼ï¼Œç»™å›¾ç‰‡åŠ ä¸Š@ç”¨æˆ·åçš„æ°´å°å­—æ ·ã€‚ä½†æ˜¯å¯¹äºä¸åŒæ ¼å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚å¯¹äºJPGã€JPEGã€PNGæ ¼å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬è·å–ç”¨æˆ·çš„ç”¨æˆ·åï¼Œå°†@ç”¨æˆ·åå­—æ ·å†™æˆå›¾ç‰‡ï¼Œä½œä¸ºlayeræ·»åŠ åˆ°åŸå›¾ç‰‡ä¸Šå³å¯ï¼›è€Œå¯¹äºGIFæ ¼å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦éå†æ¯ä¸€å¸§GIFå›¾ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠåŠ¨æ€çš„å›¾ç‰‡è½¬åŒ–ä¸ºé™æ€çš„å›¾ç‰‡åšå¤„ç†ï¼Œå†ä½¿ç”¨åœ¨é™æ€å›¾ç‰‡ä¸Šæ·»åŠ æ°´å°çš„æ–¹å¼ï¼ŒåŠ ä¸Šæ°´å°ã€‚

```python
for frame in ImageSequence.Iterator(image_origin):
    text = '@' + username
    layer = frame.convert('RGBA')
    text_overlayer = PImage.new('RGBA', layer.size, (255, 255, 255, 0))
    image_draw = ImageDraw.Draw(text_overlayer)
    text_size_x, text_size_y = image_draw.textsize(text)
    text_xy = (layer.size[0] - text_size_x, layer.size[1] - text_size_y)
    image_draw.text(text_xy, text, fill=(0, 0, 0, 50))
    temp = PImage.alpha_composite(layer, text_overlayer)
    frame = temp.convert('RGB')
    b = io.BytesIO()
    frame.save(b, format="GIF")
    frame = PImage.open(b)
    frames.append(frame)
frames[0].save(pic_path, save_all=True, append_images=frames[1:])
```

### è¡¨æƒ…æ¨èæ¨¡å—

è¡¨æƒ…æ¨èçš„æ ¸å¿ƒç®—æ³•æ˜¯æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ï¼ˆè¯¦è§ç‰¹æ®Šè®¾è®¡ä¸­çš„â€œå›¾ç‰‡æ¨èï¼šæ„ŸçŸ¥å“ˆå¸Œç®—æ³•â€ï¼‰

#### ç›¸ä¼¼æ¨è

ç›¸ä¼¼æ¨èæ˜¯é€šè¿‡è¾“å…¥ä¸€å¼ è¡¨æƒ…åŒ…è·å–è‹¥å¹²å¼ ä¸å®ƒå›¾åƒå†…å®¹ç›¸ä¼¼æˆ–è€…æ˜¯æ ‡ç­¾ç›¸ä¼¼çš„è¡¨æƒ…åŒ…ã€‚

é€šè¿‡åç«¯è°ƒç”¨æ•°æ®åº“éå†æ•°æ®åº“ä¸­çš„æ‰€æœ‰å›¾ç‰‡ï¼Œé€šè¿‡æ„ŸçŸ¥å“ˆå¸Œç®—æ³•è®¡ç®—å®ƒä¸å…¶ä»–è¡¨æƒ…åŒ…çš„ç›¸ä¼¼åº¦ï¼Œå¾—å‡ºçš„æµ·æ˜è·ç¦»è¶Šå°ç›¸ä¼¼åº¦è¶Šå¤§ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç»“åˆæ ‡ç­¾ä¸ç›®æ ‡å›¾ç‰‡çš„æ ‡ç­¾é‡åˆåº¦è¿›è¡ŒåŠ æƒè®¡ç®—è·å¾—ç»“æœã€‚

åŠ æƒæ¯”æ˜¯ç›®å‰å®éªŒçš„ç»“æœï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥è§†å¡«å……çš„å›¾ç‰‡è¿›è¡Œè°ƒæ•´ã€‚

```python
    for img_com in img_all:
        if img_com.private:
            continue
        if img_com.id == img_id:
            similarity.append(1000)  # ç»å¯¹é€‰ä¸åˆ°æˆ‘è‡ªå·±
            id_list.append(img_com.id)
        else:
            id_list.append(img_com.id)
            image_url = img_com.img
            image_type = img_type(image_url)
            pic_path_com = './emoji/images/' + 'compare.' + image_type
            with open(pic_path_com, 'wb') as f:
                f.write(base64.b64decode(image_url.split(',')[1]))
            p_similarity = get_similarity(pic_path_target, pic_path_com)
            tags_target = image.image2tag_set.all()
            tags_com = image.image2tag_set.all()
            p_tag = 0
            for tag_c in tags_com:
                for tag_t in tags_target:
                    if tag_t.tag.content == tag_c.tag.content:
                        p_tag += 1
                        break
            p_tag = len(tags_target) - p_tag
            similarity.append(p_tag * 5 + p_similarity)
```

å…¶ä¸­ï¼Œè·å–ç›¸ä¼¼åº¦çš„get_similatityå‡½æ•°è´Ÿè´£è°ƒç”¨æ„ŸçŸ¥å“ˆå¸Œç®—æ³•å‡½æ•°è®¡ç®—ç›¸ä¼¼åº¦ã€‚

```python
DHash.hamming_distance(image_target, image_com)
```

#### ä¸ªæ€§åŒ–æ¨è

æ¯ä¸ªç”¨æˆ·çš„ä¸ªæ€§æœ€æ˜æ˜¾ä¹‹å¤„åœ¨äºä»–ä»¬æ”¶è—çš„å›¾ç‰‡å–œå¥½åå·®ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬åŸºäºæ¯ä¸ªç”¨æˆ·æ”¶è—çš„å›¾ç‰‡ï¼Œéšæœºé€‰å‡ºå…¶ä¸­çš„ç™¾åˆ†ä¹‹ä¸‰åå¼ å›¾ç‰‡å±•ç¤ºä»–ä»¬çš„æ¨èå›¾ç‰‡ã€‚æ ¹æ®ç”¨æˆ·æ”¶è—çš„å˜åŒ–ï¼Œæ¨èå¯ä»¥å®æ—¶æ›´æ–°å¹¶ä¸”åœ¨æ¯æ¬¡æ‰“å¼€æ¨èçš„æ—¶å€™å‡ºç°çš„å›¾ç‰‡éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œç»´æŒäº†ç½‘ç«™çš„æ–°é²œæ„Ÿã€‚

```python
chosen = random.sample(like_list, round(len(like_list) * 0.3))
recom_list = []
num = 5
for i in chosen:
	recom_list += recommend(int(i), num)
recom_list = list(set(recom_list))
```

#### çƒ­é—¨æ¨è

çƒ­é—¨çš„å®šä¹‰æ˜¯è·å¾—äº†é«˜èµæˆ–è€…é«˜æ”¶è—çš„å›¾ç‰‡ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šé€‰å–æ•´ä¸ªç½‘ç«™ä¸­æ”¶è—å’Œç‚¹èµæ•°ç›®æœ€é«˜çš„è‹¥å¹²å¼ å›¾ç‰‡è¿›è¡Œå±•ç¤ºã€‚

### ç®¡ç†å‘˜æ¨¡å—

ç®¡ç†å‘˜ç”±äºåœ°ä½ç‰¹æ®Šæ‰€ä»¥ä¸èƒ½å¤Ÿç”±å®¢æˆ·ç«¯éšæ„æ³¨å†Œï¼Œéœ€è¦åç«¯ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ’å…¥ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå°†ç®¡ç†å‘˜æ ‡å¿—è®¾ç½®ä¸º1ã€‚

#### ä¸¾æŠ¥å®¡æ ¸

ç®¡ç†å‘˜çš„ç‰¹æƒä¸»è¦æ˜¯å¯ä»¥æŸ¥çœ‹å…¶ä»–ç”¨æˆ·ä¸¾æŠ¥çš„å›¾ç‰‡ï¼Œå¹¶å¯¹è¿™äº›å›¾ç‰‡è¿›è¡Œåˆ é™¤æˆ–è€…é‡Šæ”¾å¤„ç†ã€‚

```javascript
manager_delete(e) {
    this.$api.post('/delete_image', {
  id:e.target.parentElement.parentElement.parentElement.parentElement.lastElementChild.firstElementChild.getAttribute('id'),
    }).then(response => {
        if (response.data === 'SUCCESS') {
            this.$message.success('åˆ é™¤æˆåŠŸï¼');
            this.$router.replace({path: '/'});
            this.$router.replace({path: '/channel/' + this.$store.state.user_id + '/all' + '/hot'});
        }
    }), (response) => {
        this.$message.error('åˆ é™¤å¤±è´¥ï¼');
    }
}
```

åœ¨åˆ é™¤å®Œç‰¹æ®Šå›¾ç‰‡åå¯ä»¥å°†åˆæ³•å›¾ç‰‡ä»ä¸¾æŠ¥å›¾ç‰‡ä¸­ä¸€é”®é‡Šæ”¾

```python
reports = Report.objects.all()
for report in reports:
	report.delete()
```

ç”±äºæˆ‘ä»¬è®¾è®¡äº†ä¸€é”®æ¸…é™¤ï¼Œæ‰€ä»¥å¦‚æœç§¯ç´¯å¾ˆå¤šçš„ä¸¾æŠ¥å›¾ç‰‡ä¼šå¯¼è‡´å·¥ä½œé‡å˜å¤§ã€‚å¸Œæœ›æ¯ä¸€ä½ç®¡ç†å‘˜éƒ½èƒ½å‹¤äºä¸Šçº¿å·¥ä½œï¼Œä¸è¦è®©è¿æ³•å›¾ç‰‡åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šé•¿æ—¶é—´å­˜æ´»ã€‚

## ç‰¹æ®Šè®¾è®¡

### å›¾ç‰‡æ¨èï¼šæ„ŸçŸ¥å“ˆå¸Œç®—æ³•

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œè¡¨æƒ…åŒ…å›¾ç‰‡æ¨èçš„æ ¸å¿ƒåœ¨äºå›¾ç‰‡è¯­ä¹‰ç­›é€‰ä»¥åŠå›¾åƒæœ¬èº«çš„æ¨èã€‚

- å›¾ç‰‡è¯­ä¹‰ç­›é€‰

  éœ€æ±‚æ¥æºæ˜¯ç”¨æˆ·å¯¹äº**æŸä¸€åŠŸèƒ½**çš„è¡¨æƒ…åŒ…çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼Œç”Ÿæ°”çš„è¡¨æƒ…åŒ…ï¼Œå±•ç¤ºé£æ™¯çš„è¡¨æƒ…åŒ…ï¼Œå¸¦æœ‰ç¾é£Ÿçš„è¡¨æƒ…åŒ…ç­‰ç­‰ï¼Œè¿™ç±»éœ€æ±‚çš„å®ç°éœ€è¦é€šè¿‡é€‰æ‹©æœ‰ç€æŒ‡å®šæ ‡ç­¾çš„å›¾ç‰‡å¹¶ä¸”æ¯”è¾ƒå›¾ç‰‡ä¸ç”¨æˆ·éœ€æ±‚çš„å¥‘åˆåº¦è¿›è¡Œç­›é€‰ã€‚

- å›¾åƒç­›é€‰

  éœ€æ±‚æ¥æºæ˜¯ç”¨æˆ·å¯¹äºæŸä¸€ç±»å›¾ç‰‡ç±»å‹çš„ä¼šæœ‰**ç›¸å¯¹çš„åå¥½**ï¼Œæ¯”å¦‚ï¼Œé»‘ç™½åŸºè°ƒçš„è¡¨æƒ…åŒ…ï¼Œé¢œè‰²ä¸°å¯Œçš„è¡¨æƒ…åŒ…ç­‰ï¼Œè¿™ç±»åå¥½çš„æ»¡è¶³éœ€è¦é€šè¿‡å¯¹ç”¨æˆ·ç°æœ‰å–œçˆ±çš„å›¾ç‰‡çš„åˆ†æé€‰æ‹©å‡ºåˆé€‚çš„è¡¨æƒ…åŒ…è¿›è¡Œæ¨èã€‚

æ‰€ä»¥åœ¨æˆ‘ä»¬çš„æ¨èç®—æ³•ä¼šå¯¹ç”¨æˆ·æ”¶è—çš„å›¾ç‰‡æ ‡ç­¾å’Œå›¾åƒè¿›è¡Œç»¼åˆè®¡ç®—ï¼Œæ‰¾åˆ°æœ€å¯èƒ½è¢«ç”¨æˆ·ç»§ç»­å–œæ¬¢çš„è¡¨æƒ…åŒ…ã€‚

ç›¸å¯¹äºè¾ƒç®€å•çš„å›¾ç‰‡æ ‡ç­¾ç»Ÿè®¡ç®—æ³•ï¼Œå€¼å¾—ä¸€æçš„æ˜¯åœ¨æœ¬é¡¹ç›®ä¸­é‡‡ç”¨çš„ç”¨äºæ£€æµ‹å›¾ç‰‡ç›¸ä¼¼åº¦çš„**æ„ŸçŸ¥å“ˆå¸Œç®—æ³•**ã€‚

##### æ„ŸçŸ¥å“ˆå¸Œç®—æ³• PHA

å“ˆå¸Œç®—æ³•é€šè¿‡å°†å•å‘æ•°å­¦å‡½æ•°åº”ç”¨åˆ°ä»»æ„æ•°é‡çš„æ•°æ®æ‰€å¾—åˆ°çš„å›ºå®šå¤§å°ç»“æœã€‚ç®—æ³•åœ¨æ¥æ”¶ä¸€æ®µè¾“å…¥æ•°æ®åï¼Œä¼šä»¥ä¸€ç§ä¸å¯é€†çš„æ–¹å¼å°†å…¶è½¬åŒ–ä¸ºä¸€æ®µé•¿åº¦è¾ƒçŸ­ã€ä½æ•°å›ºå®šçš„æ•£åˆ—æ•°æ®ã€‚å¦‚æœè¾“å…¥æ•°æ®ä¸­æœ‰å˜åŒ–ï¼Œåˆ™å“ˆå¸Œä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼ˆè¿™ä¹Ÿæ˜¯å¯†ç å­¦ä¸­å¸¸å¸¸æåŠçš„**é›ªå´©æ•ˆåº”**ï¼‰ã€‚ç”±äºè¿™ä¸€ç‰¹æ€§ï¼Œå“ˆå¸Œç®—æ³•çš„ç»“æœå…·æœ‰ç‰¹å¾è¯†åˆ«èƒ½åŠ›ã€‚

å°†å“ˆå¸Œç®—æ³•åº”ç”¨äºå›¾åƒç›¸ä¼¼åº¦æ¯”è¾ƒä¸­ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯è¿™æ ·çš„ä¸€ç§**ç‰¹å¾**æ€æƒ³ã€‚é€šè¿‡æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ç»™æ¯å¼ å›¾ç‰‡ç”Ÿæˆä¸€ä¸ªâ€œæŒ‡çº¹â€ï¼ŒæŒ‡çº¹è¶Šç›¸ä¼¼çš„ä¸¤å¼ å›¾ç‰‡å®ƒä»¬çš„ç›¸ä¼¼åº¦å°±è¶Šé«˜ã€‚

åœ¨æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰ä»¥ä¸¥æ ¼çš„æ–¹å¼è®¡ç®—Hashå€¼ï¼Œè€Œæ˜¯ä»¥æ›´åŠ ç›¸å¯¹çš„æ–¹å¼è®¡ç®—å“ˆå¸Œå€¼ã€‚å®ƒçš„åŸºæœ¬æ­¥éª¤æ˜¯ç¼©å°ç®€åŒ–åŸå›¾ç‰‡-å¾—åˆ°ç‰¹å¾åŸå§‹æ•°æ®-è®¡ç®—å“ˆå¸Œå€¼ã€‚

![](https://www.mdpi.com/algorithms/algorithms-11-00006/article_deploy/html/images/algorithms-11-00006-g001.png)

è¿™ä¸€ç®—æ³•ä¹Ÿæ˜¯è°·æ­Œä»¥å›¾è¯†å›¾æœç´¢é‡‡ç”¨çš„ä¸€ç§ç®—æ³•ã€‚

æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ä¸­æœ‰ä¸‰ç§å¸¸ç”¨çš„ç®—æ³•ï¼Œå®ƒä»¬åœ¨ç‰¹å¾æ•°æ®çš„é€‰æ‹©ä¸Šæœ‰æ‰€ä¸åŒã€‚

- ahash

  ä¸»è¦åˆ©ç”¨äº†å›¾ç‰‡çš„ä½é¢‘ä¿¡æ¯

  > 1. ç¼©å°å°ºå¯¸ï¼šå»é™¤é«˜é¢‘å’Œç»†èŠ‚çš„æœ€å¿«æ–¹æ³•æ˜¯ç¼©å°å›¾ç‰‡ï¼Œå°†å›¾ç‰‡ç¼©å°åˆ°8x8çš„å°ºå¯¸ï¼Œæ€»å…±64ä¸ªåƒç´ ã€‚ä¸è¦ä¿æŒçºµæ¨ªæ¯”ï¼Œåªéœ€å°†å…¶å˜æˆ8*8çš„æ­£æ–¹å½¢ã€‚è¿™æ ·å°±å¯ä»¥æ¯”è¾ƒä»»æ„å¤§å°çš„å›¾ç‰‡ï¼Œæ‘’å¼ƒä¸åŒå°ºå¯¸ã€æ¯”ä¾‹å¸¦æ¥çš„å›¾ç‰‡å·®å¼‚ã€‚
  >
  > 2. ç®€åŒ–è‰²å½©ï¼šå°†8*8çš„å°å›¾ç‰‡è½¬æ¢æˆç°åº¦å›¾åƒã€‚
  >
  > 3. è®¡ç®—å¹³å‡å€¼ï¼šè®¡ç®—æ‰€æœ‰64ä¸ªåƒç´ çš„ç°åº¦å¹³å‡å€¼ã€‚
  >
  > 4. æ¯”è¾ƒåƒç´ çš„ç°åº¦ï¼šå°†æ¯ä¸ªåƒç´ çš„ç°åº¦ï¼Œä¸å¹³å‡å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¤§äºæˆ–ç­‰äºå¹³å‡å€¼ï¼Œè®°ä¸º1ï¼›å°äºå¹³å‡å€¼ï¼Œè®°ä¸º0ã€‚
  >
  > 5. è®¡ç®—hashå€¼ï¼šå°†ä¸Šä¸€æ­¥çš„æ¯”è¾ƒç»“æœï¼Œç»„åˆåœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ª64ä½çš„æ•´æ•°ï¼Œè¿™å°±æ˜¯è¿™å¼ å›¾ç‰‡çš„æŒ‡çº¹ã€‚ç»„åˆçš„æ¬¡åºå¹¶ä¸é‡è¦ï¼Œåªè¦ä¿è¯æ‰€æœ‰å›¾ç‰‡éƒ½é‡‡ç”¨åŒæ ·æ¬¡åºå°±è¡Œäº†ã€‚(æˆ‘è®¾ç½®çš„æ˜¯ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ç”¨äºŒè¿›åˆ¶ä¿å­˜)ã€‚

- phash

  æ˜¯dhashçš„å¢å¼ºç‰ˆï¼Œä½¿ç”¨ç¦»æ•£ä½™å¼¦å˜æ¢(DCT)é™ä½é¢‘ç‡

  > 1. ç¼©å°å°ºå¯¸ï¼špHashä»¥å°å›¾ç‰‡å¼€å§‹ï¼Œä½†å›¾ç‰‡å¤§äº8*8ï¼Œ32*32æ˜¯æœ€å¥½çš„ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ç®€åŒ–äº†DCTçš„è®¡ç®—ï¼Œè€Œä¸æ˜¯å‡å°é¢‘ç‡ã€‚
  >
  > 2. ç®€åŒ–è‰²å½©ï¼šå°†å›¾ç‰‡è½¬åŒ–æˆç°åº¦å›¾åƒï¼Œè¿›ä¸€æ­¥ç®€åŒ–è®¡ç®—é‡ã€‚
  >
  > 3. è®¡ç®—DCTï¼šè®¡ç®—å›¾ç‰‡çš„DCTå˜æ¢ï¼Œå¾—åˆ°32*32çš„DCTç³»æ•°çŸ©é˜µã€‚
  >
  > 4. ç¼©å°DCTï¼šè™½ç„¶DCTçš„ç»“æœæ˜¯32X32å¤§å°çš„çŸ©é˜µï¼Œä½†æˆ‘ä»¬åªè¦ä¿ç•™å·¦ä¸Šè§’çš„8*8çš„çŸ©é˜µï¼Œè¿™éƒ¨åˆ†å‘ˆç°äº†å›¾ç‰‡ä¸­çš„æœ€ä½é¢‘ç‡ã€‚
  >
  > 5. è®¡ç®—å¹³å‡å€¼ï¼šå¦‚åŒå‡å€¼å“ˆå¸Œä¸€æ ·ï¼Œè®¡ç®—DCTçš„å‡å€¼ã€‚
  >
  > 6. è®¡ç®—hashå€¼ï¼šè¿™æ˜¯æœ€ä¸»è¦çš„ä¸€æ­¥ï¼Œæ ¹æ®8*8çš„DCTçŸ©é˜µï¼Œè®¾ç½®0æˆ–1çš„64ä½çš„hashå€¼ï¼Œå¤§äºç­‰äºDCTå‡å€¼çš„è®¾ä¸ºâ€1â€ï¼Œå°äºDCTå‡å€¼çš„è®¾ä¸ºâ€œ0â€ã€‚ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ª64ä½çš„æ•´æ•°ï¼Œè¿™å°±æ˜¯è¿™å¼ å›¾ç‰‡çš„æŒ‡çº¹ã€‚

- dhash

  > 1. ç¼©å°å›¾ç‰‡ï¼šæ”¶ç¼©åˆ°9*8çš„å¤§å°ï¼Œä¸€éå®ƒæœ‰72çš„åƒç´ ç‚¹
  >
  > 2. è½¬åŒ–ä¸ºç°åº¦å›¾ï¼šæŠŠç¼©æ”¾åçš„å›¾ç‰‡è½¬åŒ–ä¸º256é˜¶çš„ç°åº¦å›¾ã€‚ï¼ˆå…·ä½“ç®—æ³•è§å¹³å‡å“ˆå¸Œç®—æ³•æ­¥éª¤ï¼‰
  >
  > 3. è®¡ç®—å·®å¼‚å€¼ï¼šdHashç®—æ³•å·¥ä½œåœ¨ç›¸é‚»åƒç´ ä¹‹é—´ï¼Œè¿™æ ·æ¯è¡Œ9ä¸ªåƒç´ ä¹‹é—´äº§ç”Ÿäº†8ä¸ªä¸åŒçš„å·®å¼‚ï¼Œä¸€å…±8è¡Œï¼Œåˆ™äº§ç”Ÿäº†64ä¸ªå·®å¼‚å€¼
  >
  > 4. è·å¾—æŒ‡çº¹ï¼šå¦‚æœå·¦è¾¹çš„åƒç´ æ¯”å³è¾¹çš„æ›´äº®ï¼Œåˆ™è®°å½•ä¸º1ï¼Œå¦åˆ™ä¸º0

åœ¨æ±‚è§£å®Œæ¯å¼ å›¾çš„hashå€¼åï¼Œé€šè¿‡è®¡ç®—æµ·æ˜è·ç¦»ï¼Œè·ç¦»è¶Šå°åˆ™å›¾ç‰‡ç›¸ä¼¼åº¦è¶Šé«˜ã€‚

æœ¬é¡¹ç›®ä¸­é‡‡ç”¨çš„æ˜¯æœ€åä¸€ç§æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ï¼Œç›¸æ¯”å‰ä¸¤ç§ï¼Œå®ƒçš„è®¡ç®—é€Ÿåº¦æ›´å¿«ï¼ˆä¸éœ€è¦è®¡ç®—å¹³å‡æ•°ï¼‰ï¼Œå¹¶ä¸”åœ¨æŸ¥é˜…èµ„æ–™åäº†è§£åˆ°å®ƒçš„ç²¾ç¡®åº¦ç›¸æ¯”äºå…¶ä»–ä¸¤ç§ä¹Ÿè¾ƒé«˜ã€‚

```python
class DHash(object):
    """
    æ„ŸçŸ¥å“ˆå¸Œç®—æ³•dhash
    """
    @staticmethod
    def calculate_hash(image):
        difference = DHash.__difference(image)
        decimal_value = 0
        hash_string = ""
        for index, value in enumerate(difference):
            if value:
                decimal_value += value * (2 ** (index % 8))
            if index % 8 == 7:
                hash_string += str(hex(decimal_value)[2:].rjust(2, "0"))  # ä¸è¶³2ä½ä»¥0å¡«å……ã€‚0xf=>0x0f
                decimal_value = 0
        return hash_string

    @staticmethod
    def hamming_distance(first, second):
        if isinstance(first, str):
            return DHash.__hamming_distance_with_hash(first, second)

        hamming_distance = 0
        image1_difference = DHash.__difference(first)
        image2_difference = DHash.__difference(second)
        for index, img1_pix in enumerate(image1_difference):
            img2_pix = image2_difference[index]
            if img1_pix != img2_pix:
                hamming_distance += 1
        return hamming_distance

    @staticmethod
    def __difference(image):
        resize_width = 9
        resize_height = 8
        smaller_image = image.resize((resize_width, resize_height))
        grayscale_image = smaller_image.convert("L")
        pixels = list(grayscale_image.getdata())
        difference = []
        for row in range(resize_height):
            row_start_index = row * resize_width
            for col in range(resize_width - 1):
                left_pixel_index = row_start_index + col
                difference.append(pixels[left_pixel_index] > pixels[left_pixel_index + 1])
        return difference

    @staticmethod
    def __hamming_distance_with_hash(dhash1, dhash2):
        difference = (int(dhash1, 16)) ^ (int(dhash2, 16))
        return bin(difference).count("1")
```

### å›¾ç‰‡æµ
